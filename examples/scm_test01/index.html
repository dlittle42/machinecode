
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - interactive - buffergeometry</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans|Patua+One" rel="stylesheet">
		<style>
			body {
				color: #cccccc;
				font-family:Monospace;
				font-size:13px;
				text-align:center;

				background-color: #050505;
				margin: 0px;
			
				height: 4000px;
			}

			h1{
				
			
				color: #333;

			}
			#WebGL-output{
			        width: 100%;
			    height: 100%;
			      position: fixed;
			      top: 0;
			      left: 0;
			      z-index: -1;
			}

			#output {
			  width: 100%;
			  height: 2em;
			 /* background: #eee; */
			  position: fixed;
			  top: 0;
			  left: 0;
			  font-weight: bold;
			  text-align: center;
			  line-height: 2;
			}

			#output #scrolling {
			  color: green;
			}
			#output #stopped {
			  color: red;
			}


			#info {
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;
			}


			a {

				color: #0080ff;
			}

			p{

			    margin: 100px auto;

			    font-family: 'Open Sans', sans-serif;
			    font-size: 1.5em;
			    max-width: 550px;
			    color: white;
			    opacity: 0;
			    
			}



			article{


			    line-height: 1.8em;
			    opacity: 1;
			    width: 100%;
			    margin: 100px auto;
			    width: 50%;

			}
			#logo{
				    width: 77%;
				    margin: 0 auto;
				    background-color: yellow;
				    height: 300px;
			}

			#logo h1{
				text-align: left;
				font-size: 64px;
				width: 200px;
				text-transform: uppercase;
				font-size: 100px;
    			line-height: 60px;
				font-family: 'Patua One', sans-serif;
				
			}

			#logo span{
				
				mix-blend-mode: multiply; 
			}

			.bgClip {
			    background:url('images/texture.jpg');
			  
			    background-position:50% 50%;
			  /*  font-size:200px; 
			    text-transform:uppercase;
			    text-align:center;
			    */
			    color:transparent;
			    -webkit-font-smoothing:antialiased;
			    -webkit-background-clip:text;
			    -moz-background-clip:text;
			    background-clip:text;
			    -webkit-text-fill-color:transparent;
			    margin:0;
			    /*
			-moz-animation:BackgroundAnimated 15s linear infinite;
    -ms-animation:BackgroundAnimated 15s linear infinite;
    -o-animation:BackgroundAnimated 15s linear infinite;
    animation:BackgroundAnimated 15s linear infinite;
    */
}
    @keyframes BackgroundAnimated {
    from {
        background-position:0 50%
    }
    to {
        background-position:100% 50%
    }
}
    @-webkit-keyframes BackgroundAnimated {
    from {
        background-position:0 50%
    }
    to {
        background-position:100% 50%
    }
}
    @-ms-keyframes BackgroundAnimated {<     from {
        background-position:0 50%
    }
    to {
        background-position:100% 50%
    }
}
    @-moz-keyframes BackgroundAnimated {
    from {
        background-position:0 50%
    }
    to {
        background-position:100% 50%
    }

		</style>
	</head>
	<body>

		<div id="output"></div>
		<div id="container">
			<div id="logo"> 
				<h1>
					<span class="bgClip">Super/</span>
					<span class="bgClip">Computing/</span>
					<span class="bgClip">Machine</span>
				</h1>
			</div>

			<article class="fadeable">
 
                
                <div class="animate-text" data-lining data-auto-resize >
           <!-- <h1>Welcome to our homepage.</h1> -->
            <p id="story">
                We’re a full-service advertising agency. We believe in being unforgettable. We’re relentless. We have homes on the East and West coast. We have a “No shitheads” policy. We punch above our weight, according to Forbes. We’re an Ad Age Small Agency of the Year. And we love to overdeliver.
            </p>
            <p>Here are some things we’ve been up to over the last week or so.</p>
            <h1></h1>
            <p>
                It’s something your grandparents drank. And maybe even your parents. But not so much anymore. So they brought us on board to help shake some of the dust off the brand. Our first step is digging into their social media presence. Here’s a recent post. If you want to see more, follow them on Facebook. And if you’re getting thirsty, try making a Rusty Nail.
            </p>
            <h1>What are we going to eat today?</h1>
        
              
            <p>
              We were on set this week shooting a campaign of spots to help T. Rowe Price promote their 529 College Savings Plans. There were adorable kids. Excellent directors. And a happy client. Of course, we’ll share the work when it’s ready in a couple of weeks.
            </p>
            <h1>Regular folk. Irregular passion.</h1>
          
            <p>
                Ancho Reyes is a delicious chile liquor from Puebla, Mexico. So naturally, during a recent event, we built out a Luchador Thumb Wrestling tournament. Special props goes to our maker department who, when we asked if they could build us 6 thumb wrestling rings, didn’t bat an eye, went straight to work and crushed the build. 

            </p>
            <h1>Launched iSEPTAPhilly.com</h1>

           
            <p>
                If you’re not from the same neck of the woods as our Philly office, then you’ve never heard of SEPTA. But if you are, then you most certainly have. We recently just launched a new website for the regional, public transpiration system. Aside from it just looking pretty, it’s also quite useful. Check it out here. 
            </p>
            <h1>Meanwhile, In England</h1>
            <p>
                We just launched a campaign for hi-tech protection company D30. After protecting soldiers on the battlefields and the brains of snowboarders, they partnered with GearBox to launch a line of cellphones cases that offer some insane protection for phones. The campaign launched in Carphone Warehouse, which apparently is as big in England as Haselhoff is in Germany. Seriously. Here’s a look at some of the work.
            </p>
            <h1>SXSW BOUND.</h1>
            <p>
                Next month we’ll be heading to SXSW to help GOOD with their event celebrating the GOOD 100. Our Makers will be helping them build out an interactive piece on the experience. It should be a pretty great time. We’ll keep you posted.
            </p>
            <h1>LET’S GET CRAZY</h1>
            <p>Just this week, for the second year in a row, we signed up a team from our agency to run in the Cape Cod Ragnar Rally in May. 12 people. 2 days. 200 miles. Damn.
            </p>
            <p>When we get closer, we’ll share some sights and sounds on our Facebook and Instagram pages. Oh, btw, if you don’t follow us there, you totally should.
            </p>
            <p>
                One other thing.
            </p>
            

            </div>
            </article>
		
		</div>

		

		<div id="WebGL-output"></div>
		
		<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
		<script src="../../bower_components/gsap/src/minified/TweenMax.min.js"></script>
		<script src="../../bower_components/three.js/build/three.js"></script>
		<script src="../../bower_components/three.js/examples/js/Detector.js"></script>
		<script src="../../bower_components/three.js/examples/js/controls/OrbitControls.js"></script>
		<script src="../../bower_components/three.js/examples/js/libs/stats.min.js"></script>
		<!-- <script src="../../bower_components/three.js/examples/js/renderers/Projector.js"></script> -->

		<script>

		

			var container, stats;
			var camera, scene, raycaster, renderer;

			var mouse = new THREE.Vector2(), INTERSECTED;
			var radius = 100, theta = 0;
			var objects = [];
			var particleMaterial;
			var activePanel;
			var viewWidth = window.innerWidth;
			var viewHeight = window.innerHeight;
			var vector, scaledVector;

			var controls;

			var materialOne;
			var materialArr = [];
			var imgArrIdx = 0;
			var textureLoader;

			var imgArr = [
				"contwix.png",
				"dvisa-holiday.png",
				"truenorth.png",
				"glamour.png",
				"portfoliobuilder.png",
				"santa.png",
				"werewolf.png",
				"nemo.png",
				"xd.png",
				"tru.png",
				"killbill.png"
			]

			init();
			animate();

			function init() {


				container = document.getElementById('WebGL-output');
				

				scene = new THREE.Scene();
			//	scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );

				//renderer = new THREE.WebGLRenderer();
				renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
				//renderer.setClearColor( scene.fog.color );
				renderer.setClearColor( 0xF2F2EF );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild(renderer.domElement);

				//camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 40;
				camera.position.y = 0;

				// CONTROLS
				//controls = new THREE.OrbitControls( camera, renderer.domElement );
				//controls.addEventListener( 'change', render ); // add this only if there is no animation loop (requestAnimationFrame)
				//controls.enableDamping = true;
				//controls.dampingFactor = 0.25;
				//controls.enableZoom = false;

				/*
				var light = new THREE.DirectionalLight( 0xffffff, 1 );
				light.position.set( 1, 1, 1 ).normalize();
				scene.add( light );
				

				var grid = new THREE.GridHelper(100, 10);
		        scene.add(grid);

		        var ambient = new THREE.AmbientLight( 0xffffff);
		        scene.add( ambient );

		        var directionalLight = new THREE.DirectionalLight( 0xffffff );
		        directionalLight.position.set( 0, 0, 100 );
		        scene.add( directionalLight );

		        var directionalLight2 = new THREE.DirectionalLight( 0xffeedd );
		        directionalLight2.position.set( 100, 0, 0 );
		        scene.add( directionalLight2 );

		        var directionalLight3 = new THREE.DirectionalLight( 0xffffff );
		        directionalLight3.position.set( 0, 100, 0 );
		        scene.add( directionalLight3 );
*/

// so many lights
var light = new THREE.DirectionalLight( 0xffffff, 1 );
light.position.set( 0, 1, 0 );
scene.add( light );

var light = new THREE.DirectionalLight( 0xffffff, 0.5 );
light.position.set( 0, -1, 0 );
scene.add( light );

var light = new THREE.DirectionalLight( 0xffffff, 1 );
light.position.set( 1, 0, 0 );
scene.add( light );

var light = new THREE.DirectionalLight( 0xffffff, 0.5 );
light.position.set( 0, 0, 1 );
scene.add( light );

var light = new THREE.DirectionalLight( 0xffffff, 1 );
light.position.set( 0, 0, -1 );
scene.add( light );

var light = new THREE.DirectionalLight( 0xffffff, 0.5 );
light.position.set( -1, 0, 0 );
scene.add( light );



		        //load textures 

			
				var manager = new THREE.LoadingManager();
				manager.onProgress = function ( item, loaded, total ) {
				 // progressBar.style.width = (loaded / total * 100) + '%';
				 	console.log(item, loaded, total);
				};

				manager.onLoad = function (){
					console.log('all items loaded');
					if (imgArrIdx < imgArr.length) {
						loadImages();
					}else{
						createGridWall();
					}
				}

				manager.onError = function (){
					console.log('loading error');
				}


			//	new THREE.MeshBasicMaterial( { map: videoTexture, overdraw: true, side:THREE.DoubleSide } );

				// create a loader to get an image from a URL
				textureLoader = new THREE.TextureLoader(manager);
				// we've gotta set this to use cross-origin images
				textureLoader.crossOrigin = true;

				// load in the image
				
				loadImages();


				/*
				for ( var i = 0; i < 2000; i ++ ) {

					var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );

					object.position.x = Math.random() * 800 - 400;
					object.position.y = Math.random() * 800 - 400;
					object.position.z = Math.random() * 800 - 400;

					object.rotation.x = Math.random() * 2 * Math.PI;
					object.rotation.y = Math.random() * 2 * Math.PI;
					object.rotation.z = Math.random() * 2 * Math.PI;

					object.scale.x = Math.random() + 0.5;
					object.scale.y = Math.random() + 0.5;
					object.scale.z = Math.random() + 0.5;

					scene.add( object );

					TweenMax.to(object.position ,Math.random()*200,{
						x:0,
						y:0,
						ease:"Power3.easeOut",
						onUpdate:function(){
                      //  console.log('tweened');
                    }});

				}
				*/

				raycaster = new THREE.Raycaster();

				stats = new Stats();
				container.appendChild( stats.dom );

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'mouseup', onDocumentMouseUp, false );

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function loadImages(){
				
				textureLoader.load("images/portfolio620/"+imgArr[imgArrIdx], function(texture) {
				  // this code makes the texture repeat
				//  texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
				//  texture.repeat.set( 10, 10 );
				  // set the texture as the map for the material
				//  materialOne = texture;//new THREE.MeshLambertMaterial( {map: texture, side:THREE.DoubleSide } );
				  materialArr.push(texture);
				  console.log("materialArr="+materialArr);
				  imgArrIdx++;
				


				
				 })




			}



			function createGridWall(){
				//var geometry = new THREE.BoxBufferGeometry( 20, 20, 20 );
					//var geometry = new THREE.PlaneBufferGeometry( 10, 10, 5 );
					var geometry = new THREE.PlaneGeometry( 10, 10, 5 );

					var objWidth = 10;
					var maxRow = 2;
					var maxCol = 100;
					var hspacing = 12.5;
					var vspacing = 12.5;
					var xoffset = 0;//((objWidth + hspacing)* maxRow)/2;

					for (var i = 0; i < maxRow; i++) {
					     for (var j = 0; j < maxCol; j++) {
					      	//var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff, side: THREE.DoubleSide } ) );
					      	var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( {map: materialArr[(i+j)%imgArr.length], side:THREE.DoubleSide } ));

					      	object.doubleSided = true;
					      	object.geometry.computeBoundingSphere(); // this isn't calculated automatically
							object.geometry.boundingSphere.center;

							var xpos = ((hspacing * j) - hspacing/2) - xoffset;
							var ypos = (vspacing  * i)  - ((vspacing/2)*maxRow);
							var zpos = Math.random() * 400 - 200;

							object.position.x = xpos;
							object.position.y = ypos;
							object.position.z = 0;
							object.origin = [xpos, ypos];
							scene.add( object );
							objects.push( object );
					     }
					 }


					 particleMaterial = new THREE.SpriteMaterial( { color: 0x0f0f0f, fog: true } );
			}


			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				event.preventDefault();

				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

			}

			function onDocumentMouseDown( event ) {

				event.preventDefault();

			//	console.log(THREE.Vector3( 0, 0, -1 ).applyQuaternion( camera.quaternion ).add( camera.position ));

				mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

				raycaster.setFromCamera( mouse, camera );

				vector = new THREE.Vector3( 0, 0, -1 );
				vector.applyQuaternion( camera.quaternion ).add( camera.position );

				console.log(vector);

				scaledVector=vector.clone().multiplyScalar(0.95);

				console.log("scaled:"+scaledVector.y);

				var intersects = raycaster.intersectObjects( objects );

				if ( intersects.length > 0 ) {

					if (activePanel == intersects[ 0 ].object){
						activePanel = null;
						TweenMax.to(intersects[0].object.position, 1, {
							x:intersects[0].object.origin[0],
							y:intersects[0].object.origin[1],
							z:0,
							delay: 0,
							//ease:"Power3.easeOut",
							ease: Back.easeInOut.config(.5),
							onUpdate:function(){
	                      //  console.log('tweened');

	                    	}
						});

						TweenMax.to(intersects[0].object.rotation, 1, {
							x:0,
							y:0,
							z:0,
							delay: 0,
							//ease:"Power3.easeOut",
							ease: Back.easeInOut.config(.5),
							onUpdate:function(){
	                      //  console.log('tweened');
	                    	}
						});

					}else{
						activePanel = intersects[ 0 ].object;
					}

					intersects[ 0 ].object.material.color.setHex( 0xe02323 );

					var newSphereGeom= new THREE.SphereGeometry(.5,.5,.5);
					var sphere= new THREE.Mesh(newSphereGeom, new THREE.MeshBasicMaterial({ color: 0x2266dd }));

					sphere.position.copy( intersects[ 0 ].point );
					sphere.scale.x = sphere.scale.y = 1;
					scene.add( sphere );

					drawRayLine( raycaster );
					/*
					TweenMax.to(intersects[0].object.position, 1, {
						x:camera.position.x,
						y:camera.position.y,
						z:camera.position.z -50,
						delay: .5,
						//ease:"Power3.easeOut",
						ease: Back.easeInOut.config(.5),
						onUpdate:function(){
                      //  console.log('tweened');
                    	}
					});
					TweenMax.to(intersects[0].object.rotation, 1, {
						x:camera.rotation.x,
						y:camera.rotation.y,
						z:camera.rotation.z,
						delay: 1,
						//ease:"Power3.easeOut",
						ease: Back.easeInOut.config(.5),
						onUpdate:function(){
                      //  console.log('tweened');
                    	}
					});
					*/

				}

				/*
				// Parse all the faces
				for ( var i in intersects ) {

					intersects[ i ].face.material[ 0 ].color.setHex( Math.random() * 0xffffff | 0x80000000 );

				}
				*/
			}

			function onDocumentMouseUp( event ) {

				event.preventDefault();
				if (activePanel){
					TweenMax.to(activePanel.position, 1, {
						x:scaledVector.x,
						y:scaledVector.y,
						z:scaledVector.z,
						delay: 0,
						ease:"Power3.easeOut",
						//ease: Back.easeInOut.config(.5),
						onComplete:function(){
                      //  console.log('tweened');
                      		console.log("x:"+activePanel.position.x+", y:"+ activePanel.position.y+ ", z:"+ activePanel.position.z);
                      		

                    	}
					});
					
					//activePanel.translateOnAxis(activePanel.worldToLocal(new THREE.Vector3(0,0,5)),50);
					TweenMax.to(activePanel.rotation, 1, {
						x:camera.rotation.x,
						y:camera.rotation.y,
						z:camera.rotation.z,
						delay: 0,
						//ease:"Power3.easeOut",
						ease: Back.easeInOut.config(.5),
						onUpdate:function(){
                      //  console.log('tweened');
                    	}
					});
					//activePanel = null;

				}

			}
			function getFactorPos( val, factor, step )
			{
			    return step / factor * val;                
			}

			function addNewParticle(pos, scale)
			{
			    if( !scale )
			    {
			        scale = 16;
			    }
			    var particle = new THREE.Sprite( particleMaterial );
			    particle.position = pos;
			    particle.scale.x = particle.scale.y = scale;
			    scene.add( particle );
			}

			function drawParticleLine(pointA,pointB)
			{
			    var factor = 50;
			    for( var i = 0; i < factor; i++ )
			    {
			        var x = getFactorPos( pointB.x - pointA.x, factor, i );
			        var y = getFactorPos( pointB.y - pointA.y, factor, i );
			        var z = getFactorPos( pointB.z - pointA.z, factor, i );
			        addNewParticle( new THREE.Vector3( pointA.x+x,pointA.y+y,pointA.z+z ), Math.max(2, viewWidth / 500 ) );
			    }
			}

			function drawRayLine(rayCaster)
			{
			    var scale = viewWidth*2;
			    var rayDir = new THREE.Vector3(rayCaster.ray.direction.x*scale,rayCaster.ray.direction.y*scale,rayCaster.ray.direction.z*scale);
			    var rayVector = new THREE.Vector3(camera.position.x + rayDir.x, camera.position.y + rayDir.y, camera.position.z + rayDir.z);
			    drawParticleLine(camera.position, rayVector);
			}                       


			//

			function animate() {

				requestAnimationFrame( animate );

				render();
				stats.update();
				//controls.update();
			

			}

			function render() {

				camera.lookAt( scene.position );
/*
				theta += 0.1;

				camera.position.x = radius * Math.sin( THREE.Math.degToRad( theta ) );
				camera.position.y = radius * Math.sin( THREE.Math.degToRad( theta ) );
				camera.position.z = radius * Math.cos( THREE.Math.degToRad( theta ) );
				camera.lookAt( scene.position );

				camera.updateMatrixWorld();

				// find intersections

				raycaster.setFromCamera( mouse, camera );
				*/
/*
				var intersects = raycaster.intersectObjects( scene.children );

				if ( intersects.length > 0 ) {

					if ( INTERSECTED != intersects[ 0 ].object ) {

						//if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

						INTERSECTED = intersects[ 0 ].object;
						//INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
						//INTERSECTED.material.emissive.setHex( 0xff0000 );

					}

				} else {

					//if ( INTERSECTED ) INTERSECTED.material.emissive.setHex( INTERSECTED.currentHex );

					INTERSECTED = null;

				}
*/
				renderer.render( scene, camera );
			

			}


		var $output = $( "#output" ),
        isScrolling = false,
        scrolling = "<span id='scrolling'>Scrolling</span>",
        stopped = "<span id='stopped'>Stopped</span>",
        delta=1,
        lastScrollPosition = 0,
        dist = 0;


  

        $( window ).scroll(function() {
            $output.html( scrolling );
            isScrolling =true;

            var newScrollPosition = window.scrollY;
            dist = newScrollPosition - lastScrollPosition;
 
            if (newScrollPosition < lastScrollPosition){
                //upward - code here
                delta = 1;
            }else{
                //downward - code here
                delta = -1;
            }
            console.log("delta="+delta);
            lastScrollPosition = newScrollPosition;


            console.log($(document).scrollTop());
              var pos = -Math.floor($(document).scrollTop());
              scrollPos= pos;
              camera.position.x = Math.floor($(document).scrollTop());


            clearTimeout( $.data( this, "scrollCheck" ) );
            $.data( this, "scrollCheck", setTimeout(function() {
                $output.html( stopped );
                isScrolling =false;
               // resetPanel();


            }, 250) );

        });

		</script>

	</body>
</html>
